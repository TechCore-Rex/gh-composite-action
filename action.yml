name: "TechCore Action"
description: "Deploy your application to the TechCore platform"
inputs:
  techcore-api-key: # id of input
    description: "API Key from the TechCore Platform"
    required: true
  environment: # id of input
    description: "The TechCore Environment you want to target"
    required: true
  docker-args: # id of input
    description: "The TechCore Environment you want to target"
    required: false
  image-repo-name: # id of input
    description: "ECR Repository to use"
    required: true
runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v3
    - name: Create repo if doesnt exist
      continue-on-error: true
      shell: bash
      run: |
        aws ecr create-repository --repository-name ${{inputs.image-repo-name}} --region us-east-1
    - name: Build, tag, and push image to Amazon ECR
      env:
        ECR_REGISTRY: techcore
        ECR_REPOSITORY: ${{ inputs.image-repo-name }}
        IMAGE_TAG: ${{ github.sha }}
      shell: bash
      run: |
        docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG ${{inputs.docker-args}} .
        aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin 930245254249.dkr.ecr.us-east-1.amazonaws.com
        docker push $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG
